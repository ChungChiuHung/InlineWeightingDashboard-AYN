{% extends "base.html" %}

{% block content %}
<!-- Status & Key Metrics Row -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    
    <!-- MACHINE STATUS CARD -->
    <div id="card-status" class="rounded-lg shadow-md p-6 flex flex-col justify-between transition-colors duration-500 bg-white border-l-8 border-gray-300">
        <div class="flex justify-between items-start">
            <h2 class="text-sm font-semibold uppercase tracking-widest opacity-80">機台狀態</h2>
            <i class="fa-solid fa-microchip text-2xl opacity-50"></i>
        </div>
        <div class="mt-4">
            <span id="val-status" class="text-4xl font-black tracking-tight">等待中...</span>
        </div>
        <div class="mt-2 text-xs opacity-75">
            模式: <span id="val-mode">自動</span>
        </div>
    </div>

    <!-- CURRENT WEIGHT CARD -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-8 border-blue-500 flex flex-col justify-between">
        <div class="flex justify-between items-start">
            <h2 class="text-gray-500 text-sm font-semibold uppercase tracking-widest">即時重量</h2>
            <i class="fa-solid fa-scale-balanced text-blue-300 text-2xl"></i>
        </div>
        <div class="mt-4">
            <span id="val-weight" class="font-mono text-5xl font-bold text-gray-800">0.00</span>
            <span class="text-xl text-gray-500 ml-1">kg</span>
        </div>
        <div class="mt-2 text-xs text-gray-400">
            感測器: Mettler Toledo
        </div>
    </div>

    <!-- FISH CATEGORY CARD -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-8 border-purple-500 flex flex-col justify-between">
        <div class="flex justify-between items-start">
            <h2 class="text-gray-500 text-sm font-semibold uppercase tracking-widest">當前生產</h2>
            <i class="fa-solid fa-fish text-purple-300 text-2xl"></i>
        </div>
        <div class="mt-4">
            <div id="val-fish-name" class="text-3xl font-bold text-gray-800">---</div>
            <div class="text-sm text-gray-400 font-mono mt-1">代碼: <span id="val-fish-code">----</span></div>
        </div>
        <a href="/ui/categories" class="mt-2 text-xs text-purple-600 font-semibold hover:underline block">
            <i class="fa-solid fa-gear mr-1"></i> 設定魚種分類
        </a>
    </div>
</div>

<!-- Charts Row -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Real-time Weight Trend -->
    <div class="bg-white rounded-lg shadow-md p-4 flex flex-col">
        <h3 class="text-gray-600 font-bold mb-4 text-sm border-b pb-2">
            <i class="fa-solid fa-chart-line mr-2"></i> 即時產量趨勢 (近 1 分鐘)
        </h3>
        <!-- Added explicit height style to container -->
        <div class="relative w-full flex-grow" style="min-height: 300px;">
            <canvas id="weightChart"></canvas>
        </div>
    </div>

    <!-- Production Stats -->
    <div class="bg-white rounded-lg shadow-md p-4 flex flex-col">
        <h3 class="text-gray-600 font-bold mb-4 text-sm border-b pb-2">
            <i class="fa-solid fa-chart-pie mr-2"></i> 今日產量統計
        </h3>
        <!-- Added explicit height style to container -->
        <div class="relative w-full flex-grow flex justify-center items-center" style="min-height: 300px;">
            <canvas id="productionChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- 加入版本號參數 v={{v}} 強制清除快取 -->
<script type="module" src="/static/js/dashboard.js?v={{ v }}"></script>
{% endblock %}